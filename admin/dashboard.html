<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Dashboard - Salary Slip Generator</title>

    <!-- Global site CSS (replace path if à¤†à¤ªà¤•à¤¾ CSS à¤…à¤²à¤— à¤¹à¥ˆ) -->
    <link rel="stylesheet" href="../style.css">
    <!-- Optional admin specific styling -->
    <link rel="stylesheet" href="style.css">

    <!-- PDF libs (required) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>

    <style>
        /* Minimal local styles to ensure layout works on mobile */
        :root{--card-bg:#fff;--accent:#1877f2;--muted:#666}
        body{font-family: Arial, Helvetica, sans-serif; margin:0; background:#f5f7fb; color:#222}
        .site-header{background:linear-gradient(90deg,#f97316,#ef4444); color:#fff; padding:12px 16px; display:flex; align-items:center; gap:12px}
        .site-header img.logo-left-img{height:40px; border-radius:6px}
        .brand-name{margin:0;font-size:16px}
        .brand-tagline{margin:0;font-size:11px;opacity:0.9}
        .top-contact{margin-left:auto; font-size:13px}
        .container{max-width:920px;margin:20px auto;padding:0 12px}
        .card{background:var(--card-bg); border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.06); padding:18px; margin-bottom:18px}
        h2{margin:0 0 12px 0; font-size:18px}
        .input-group{margin-bottom:12px}
        label{display:block;font-size:13px;color:var(--muted); margin-bottom:6px}
        input[type="text"], input[type="password"]{width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e2e8f0; box-sizing:border-box; font-size:14px}
        .primary-button{background:var(--accent); color:#fff; padding:10px 14px; border:none; border-radius:8px; cursor:pointer; width:100%; font-size:15px}
        .secondary-button{background:#e6eefc; color:#123; padding:8px 12px; border-radius:8px; border:1px solid #dbeafe; cursor:pointer}
        .hidden{display:none !important}
        .error-message{color:#c53030; margin-top:6px; display:none}
        #salaryDetails{font-size:14px; color:#111}
        .slip-template{width:800px; max-width:800px; background:#fff; padding:18px; border-radius:6px}
        .slip-logo{height:60px}
        /* responsive */
        @media(max-width:720px){
            .slip-template{width:320px; max-width:92%}
            .site-header{flex-wrap:wrap}
            .brand-name{font-size:15px}
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="site-header" role="banner">
        <img src="../logo.png" alt="Company Logo" class="logo-left-img" />
        <div style="line-height:1">
            <div class="brand-name">ANNAPURNA LOGISTICS</div>
            <div class="brand-tagline">Reliable Transport &amp; Manpower Partner</div>
        </div>
        <div class="top-contact" aria-hidden="true">ðŸ“ž 07667 079711 &nbsp; ðŸ“ž 91224 40600</div>
    </header>

    <!-- Page content -->
    <main class="container" role="main">
        <div class="card">
            <h2>Admin Panel â†’ Employee Salary Lookup</h2>

            <div class="input-group">
                <label for="sheetId">Google Sheet ID (readonly)</label>
                <input id="sheetId" type="text" value="1jCx_xflDltZB2YPWddp3nW0ZKIkrupr0hqXkuDo41lU" readonly>
            </div>

            <div class="input-group">
                <label for="sheetName">Sheet Name (Month)</label>
                <input id="sheetName" type="text" placeholder="e.g., May" value="May">
            </div>

            <div class="input-group">
                <label for="employeeId">Employee ID (e.g., JJT15)</label>
                <input id="employeeId" type="text" placeholder="Enter Emp ID">
            </div>

            <button id="searchButton" class="primary-button">Search Employee</button>

            <p id="errorMessage" class="error-message"></p>
        </div>

        <!-- Result Card (hidden until search) -->
        <div id="resultCard" class="card hidden">
            <h2>Salary Details (Preview)</h2>
            <div id="salaryDetails"> <!-- Filled by JS --> </div>

            <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap">
                <button id="downloadPdfButton" class="primary-button" style="flex:1">Download Salary Slip PDF</button>
                <button id="printSlipButton" class="secondary-button" style="flex:1">Print Salary Slip</button>
            </div>
        </div>

        <!-- Logout button -->
        <div style="text-align:right; margin-top:6px">
            <button id="logoutButton" class="secondary-button">Logout</button>
        </div>

        <hr style="margin:22px 0">

        <p style="font-size:13px; color:#555">
            Notes:
            <ul style="margin:6px 0 0 18px">
                <li>Sheet must be shared as: <strong>Anyone with the link â†’ Viewer</strong></li>
                <li>Column order expected: <strong>A:Emp ID, B:Name, C:Bank Account, D:Rate/Day, E:Days in Month, F:Present, G:Absent, H:Net Pay</strong></li>
                <li>Use Admin Login page to access this dashboard (credentials stored in admin login script)</li>
            </ul>
        </p>
    </main>

    <!-- Hidden Salary Slip Template (filled by JS then exported) -->
    <div id="slip" class="slip-template hidden" aria-hidden="true" style="position:fixed; left:20000px; top:20000px;">
        <div style="text-align:center; margin-bottom:8px">
            <img src="../logo.png" alt="Company Logo" class="slip-logo">
            <h1 style="margin:6px 0 2px 0;">Annapurna Logistics</h1>
            <div style="font-size:12px; color:#333;">Reliable Transport &amp; Manpower Partner</div>
            <div style="font-size:11px; color:#444; margin-top:6px">Contact: 07667 079711 â€¢ 91224 40600</div>
            <h3 style="margin-top:12px;">Salary Slip for <span id="slip-month"></span></h3>
            <hr>
        </div>

        <div style="font-size:14px; color:#222; padding:6px 0;">
            <p><strong>Employee ID:</strong> <span id="slip-empid"></span></p>
            <p><strong>Employee Name:</strong> <span id="slip-name"></span></p>
            <p><strong>Bank Account:</strong> <span id="slip-bank"></span></p>
            <hr>
            <div style="display:flex; gap:12px; flex-wrap:wrap;">
                <div style="flex:1">
                    <p><strong>Rate Per Day:</strong> <span id="slip-rate"></span></p>
                    <p><strong>Present Days:</strong> <span id="slip-present"></span></p>
                    <p><strong>Absent Days:</strong> <span id="slip-absent"></span></p>
                </div>
                <div style="flex:1">
                    <p><strong>GROSS PAY:</strong> â‚¹ <span id="slip-gross-pay"></span></p>
                    <p><strong>PF (12%):</strong> â‚¹ <span id="slip-pf-deduction"></span></p>
                    <p><strong>ESI (0.75%):</strong> â‚¹ <span id="slip-esi-deduction"></span></p>
                </div>
            </div>
            <hr>
            <h2 style="text-align:center; margin:8px 0;">NET PAY: â‚¹ <span id="slip-netpay"></span></h2>
        </div>

        <div style="margin-top:18px; text-align:right; padding-right:6px;">
            <div style="display:inline-block; text-align:center;">
                <div style="height:50px;"></div>
                <div>_________________________</div>
                <div>Authorized Signature</div>
            </div>
        </div>
    </div>

    <!-- App JS (must be placed after slip template & elements) -->
    <script src="main.js" defer></script>

    <!-- Small init for print button (main.js also attaches listeners on DOMContentLoaded) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const printBtn = document.getElementById('printSlipButton');
            if (printBtn) {
                printBtn.addEventListener('click', () => {
                    // main.js provides generatePrint via window scope (if present)
                    if (typeof generatePrint === 'function') {
                        generatePrint();
                    } else {
                        // fallback simple print of slip
                        const slip = document.getElementById('slip');
                        if (!slip) return alert('Slip not ready');
                        slip.classList.remove('hidden');
                        slip.style.position = 'static';
                        window.print();
                        slip.classList.add('hidden');
                        slip.style.position = 'fixed';
                    }
                });
            }
        });
    </script>

</body>
</html>
